<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
  <title>å¤šPDFæ™ºèƒ½æª¢ç´¢å™¨ (æ»‘å‡ºå¼é¸å–®)</title>
  <!-- å¼•å…¥ Font Awesome çš„åœ–ç¤ºåº« -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* --- å…¨æ–°çš„ CSS æ¨£å¼ --- */
    :root {
      --sidebar-width: 280px;
      --sidebar-handle-width: 35px;
      --sidebar-handle-height: 80px;
    }

    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      overscroll-behavior-y: contain;
      background-color: #e9ecef; /* èƒŒæ™¯è‰²ç§»åˆ° body */
    }

    #app-container {
      display: flex;
      flex-direction: row; /* ä¸»è¦æ–¹å‘æ”¹ç‚ºæ©«å‘ */
      height: 100%;
      width: 100%;
    }

    /* æ–°çš„å´é‚Šæ¬„æ¨£å¼ (å–ä»£èˆŠçš„ #toolbar) */
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: var(--sidebar-width);
      background-color: #f0f0f0;
      border-right: 1px solid #ccc;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 1002;
      display: flex;
      flex-direction: column;
      transform: translateX(calc(-1 * var(--sidebar-width)));
      transition: transform 0.3s ease-in-out;
      padding: env(safe-area-inset-top, 0) 0 env(safe-area-inset-bottom, 0); /* é©é…å®‰å…¨å€åŸŸ */
    }

    #sidebar.open {
      transform: translateX(0);
    }
    
    #sidebar-content {
      padding: 20px 15px;
      overflow-y: auto;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    #sidebar h2 {
      margin: 0 0 10px 0;
      font-size: 1.2em;
      white-space: nowrap;
      color: #333;
    }

    /* å´é‚Šæ¬„å…§çš„æ§åˆ¶é …æ¨£å¼ */
    #sidebar-content input,
    #sidebar-content select,
    #sidebar-content button {
      width: 100%;
      padding: 8px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 1em;
      box-sizing: border-box;
    }
    #sidebar-content input[type="number"] { text-align: center; }

    #page-navigation {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    #page-navigation .page-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
     #page-navigation .page-controls input[type="number"] { flex-grow: 1; }
     
    /* æ»‘å‡ºæŠŠæ‰‹æŒ‰éˆ• */
    #sidebar-handle {
      position: absolute;
      top: 50%;
      left: 100%;
      transform: translateY(-50%);
      width: var(--sidebar-handle-width);
      height: var(--sidebar-handle-height);
      background-color: #ff9a15;
      border: none;
      border-radius: 0 10px 10px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      box-shadow: 2px 0 5px rgba(0,0,0,0.2);
    }
    
    #sidebar-handle .fa-chevron-right {
      transition: transform 0.3s ease-in-out;
    }
    
    #sidebar.open #sidebar-handle .fa-chevron-right {
       transform: rotate(180deg);
    }

    #pdf-container {
      position: relative;
      flex-grow: 1;
      overflow: auto;
      padding: 10px;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
    }

    /* ... å…¶ä»– PDFã€FAB æŒ‰éˆ•ç­‰æ¨£å¼ä¿æŒä¸è®Š ... */
    #pdf-canvas { border: 1px solid #000; display: block; margin: 0 auto; }
    #text-layer { position: absolute; z-index: 5; pointer-events: none; }
    #drawing-canvas { position: absolute; z-index: 10; touch-action: none; pointer-events: none; }
    #magnifier-glass { display: none; position: absolute; border: 2px solid #333; border-radius: 50%; overflow: hidden; z-index: 2000; pointer-events: none; background-color: white; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
    #magnifier-canvas { display: block; }
    #text-layer > div { color: transparent; position: absolute; line-height: 1; white-space: pre; user-select: none; }
    #text-layer.text-selection-active > div { color: initial !important; user-select: text !important; }
    #text-layer.text-selection-active > div.wavy-underline { color: initial !important; }
    .wavy-underline { text-decoration-line: underline; text-decoration-style: wavy; text-decoration-color: sandybrown; text-decoration-thickness: 2px; text-underline-offset: 0.2em; }
    .highlights-hidden .wavy-underline { text-decoration: none !important; }
    #resultsDropdown .wavy-underline { text-decoration-line: underline !important; text-decoration-style: wavy !important; text-decoration-color: sandybrown !important; }
    #floating-action-buttons { position: fixed; bottom: calc(20px + env(safe-area-inset-bottom, 0px)); right: calc(20px + env(safe-area-inset-right, 0px)); z-index: 1003; display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
    .fab-button-group { display: flex; flex-direction: row; gap: 10px; align-items: center; }
    #floating-action-buttons button { background-color: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 24px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; }
    #floating-action-buttons button:hover { background-color: rgba(0, 0, 0, 0.7); }
    #floating-action-buttons button:disabled { opacity: 0.5; cursor: not-allowed; background-color: rgba(0,0,0,0.3); }
    .toggle-underline-icon { font-size: 1.1em; font-weight: bold; display: inline-block; }
    #toggle-underline-btn.active .toggle-underline-icon { text-decoration-line: underline; text-decoration-style: wavy; text-decoration-color: sandybrown; text-decoration-thickness: 2px; text-underline-offset: 0.15em; }
    #toggle-highlighter-btn.active { background-color: rgba(0, 100, 0, 0.7); }
    #toggle-text-selection-btn.active { background-color: rgba(0, 0, 100, 0.7); }
    #toggle-local-magnifier-btn.active { background-color: rgba(100, 0, 100, 0.7); }

  </style>
</head>
<body>
  <div id="app-container">
    
    <!-- å…¨æ–°çš„å´é‚Šæ¬„çµæ§‹ -->
    <div id="sidebar">
      <div id="sidebar-content">
        <!-- ** MODIFIED PART: Added a link to the instructions.html ** -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2>PDF å·¥å…·</h2>
          <a href="./instructions.html" title="æŸ¥çœ‹ä½¿ç”¨èªªæ˜" target="_blank" style="font-size: 1.2em; color: #6c757d; text-decoration: none;">
            <i class="fas fa-question-circle"></i>
          </a>
        </div>
        
        <label for="fileInput" style="display: block; font-size: 0.9em;">é¸æ“‡ä¸€å€‹æˆ–å¤šå€‹PDFæª”æ¡ˆ:</label>
        <input type="file" id="fileInput" accept="application/pdf" multiple />
        
        <input type="text" id="searchInput" placeholder="é—œéµå­—æˆ–æ­£å‰‡" />
        <button id="search-action-button">æœå°‹</button>
        <select id="resultsDropdown">
          <option value="">æœå°‹çµæœ</option>
        </select>

        <div id="quality-control" style="display: flex; align-items: center; gap: 5px; justify-content: space-between;">
          <label for="quality-selector">ç•«è³ª:</label>
          <select id="quality-selector" style="flex-grow: 1;">
              <option value="1.0">æ¨™æº–</option>
              <option value="1.5" selected>é«˜</option>
              <option value="2.0">æœ€é«˜</option>
          </select>
        </div>
        
        <div id="local-magnifier-zoom-controls" style="display: none; align-items: center; gap: 5px; justify-content: space-between;">
          <label for="local-magnifier-zoom-selector">æ”¾å¤§é¡å€ç‡:</label>
          <select id="local-magnifier-zoom-selector" style="flex-grow: 1;">
              <option value="1.5">1.5x</option>
              <option value="2.0">2.0x</option>
              <option value="2.5" selected>2.5x</option>
              <option value="3.0">3.0x</option>
              <option value="3.5">3.5x</option>
          </select>
        </div>
        
        <hr>

        <div id="page-navigation">
          <div class="page-controls">
            <button id="go-to-first-page">å›é¦–é </button>
            <button id="prev-page">ä¸Šä¸€é </button>
            <span id="page-num-display">- / -</span>
            <button id="next-page">ä¸‹ä¸€é </button>
          </div>
          <input type="range" id="page-slider" min="1" max="1" value="1" disabled>
          <div class="page-controls">
              <input type="number" id="page-to-go" min="1" placeholder="é ">
              <button id="go-to-page-btn">è·³</button>
          </div>
        </div>
      </div>
      
      <!-- æ»‘å‡ºæŠŠæ‰‹ -->
      <button id="sidebar-handle">
        <i class="fas fa-chevron-right fa-lg"></i>
      </button>
    </div>

    <!-- PDF å…§å®¹é¡¯ç¤ºå€ -->
    <div id="pdf-container">
      <canvas id="pdf-canvas"></canvas>
      <div id="text-layer" class="textLayer"></div>
      <canvas id="drawing-canvas"></canvas>
      <div id="magnifier-glass">
        <canvas id="magnifier-canvas"></canvas>
      </div>
    </div>
  </div>

  <!-- æµ®å‹•æŒ‰éˆ•å€ -->
  <div id="floating-action-buttons">
    <button id="toggle-underline-btn" title="åˆ‡æ›æœå°‹çµæœåº•ç·š">
        <span class="toggle-underline-icon">S</span>
    </button>
    <button id="toggle-text-selection-btn" title="å•Ÿç”¨æ–‡å­—é¸å–">TS</button>
    <div class="fab-button-group">
        <button id="toggle-highlighter-btn" title="å•Ÿç”¨è¢å…‰ç­†">ğŸ–Œï¸</button>
        <button id="clear-highlighter-btn" title="æ¸…é™¤è¢å…‰ç­†æ¨™è¨˜">ğŸ—‘ï¸</button>
    </div>
    <button id="toggle-local-magnifier-btn" title="åˆ‡æ›æ”¾å¤§é¡">ğŸ”</button>
    <div class="fab-button-group">
        <button id="export-page-btn" title="å°‡ç›®å‰é é¢åŒ¯å‡ºç‚ºåœ–ç‰‡">ğŸ“·</button>
        <button id="share-page-btn" title="åˆ†äº«ç›®å‰é é¢">ğŸ”—</button>
    </div>
  </div>

  <script type="module" id="pdfjs-lib" src="./lib/pdfjs/pdf.mjs"></script>
  <script type="module" src="./script.js"></script>
</body>
</html>
